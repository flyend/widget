 
 
 
 
 
 
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		
 
		<title>My JSP 'addRole.jsp' starting page</title>
		<script language="javascript"
			src="http://192.168.0.128:8080/miiap/public/js/jquery-1.6.js"></script>
 
		<!-- 引用树控件 begion -->
		
 
		<script language="javascript"
			src="../_$.js"></script>
			
		<script language="javascript"
			src="tree.js"></script>
 
		<link rel="stylesheet" type="text/css"
			href="http://192.168.0.128:8080/miiap/public/tree/tree.css">
		<!-- 引用树控件 end -->
 
 
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="This is my page">
		<!--
	<link rel="stylesheet" type="text/css" href="styles.css">
	-->
		<script language="javascript"> 
	function existName() {
		// 获得值
		var roleName = $("#roleName").attr("value");
		alert(roleName);
		$
				.ajax({
					url : "/miiap/queryRoleByNameOrId.action",
					data : "roleName=" + roleName,
					type : "POST",
					cache : "false", // 是否缓存页面
					dataType : "json", // 使用Json传递返回值
					success : function(data) {
						//alert(data);
						var message = eval("(" + data + ")");
						if (message.exsitName == "true") {
							alert("已经被占用");
							$("#roleName").focus();
						}
 
					}
				});
	}
</script>
 
 
		<script language="javascript" type="text/javascript"> 
	$(document).ready(function() {
		$('#roleSelect').change(function() {
			var selectValue = $(this).children('option:selected').val();//这就是selected的值
			alert(selectValue);
			//var p2 = $('#param2').val();//获取本页面其他标签的值 
			//window.location.href = "xx.php?param1=" + p1 + "¶m2=" + p2 + "";//页面跳转并传参
			loadSelectRoleIsPrivilegeList(selectValue);
		})
	})
 
	function loadSelectRoleIsPrivilegeList(selecrRoleId) {
		$
				.ajax({
					url : "/miiap/queryPrivilegeByRoleId.action",
					data : "roleId=" + selecrRoleId,
					type : "POST",
					cache : "false", // 是否缓存页面
					dataType : "json", // 使用Json传递返回值
					success : function(data) {
						var message = eval("(" + data + ")");
						var arr = message.privilegeStr.split(",");
						alert(arr.length + "当前角色包含的权限数量");
						var checkArr = document
								.getElementsByName("privilegeList");
						var n = checkArr.length;
						alert(n + "多少个复选框");
						for ( var i = 0; i < n; i++) {
							// 如果当前的角色的id在包括在列表中展示，则选中
 
						}
 
					}
				});
	}
</script>
	</head>
 
	<body>
		<form id="roleForm" action="doAddRole" method="post">
			<table width="500" border="1" align="center" bordercolor="#9966FF"
				style="border-collapse: collapse">
				<tr style="font-size: 14px;">
					<td colspan="4" align="left">
						<br>
						角色信息
					</td>
				</tr>
				<tr>
					<td width="48">
						角色名称
					</td>
					<td>
						<input name="roleBean.roleName" type="text" id="roleName"
							onblur="existName()" />
					</td>
					<td width="86">
						备注
					</td>
					<td>
						<input type="text" name="roleBean.remark" id="remark" />
					</td>
				</tr>
 
 
				<tr>
					<td width="48">
						复制角色
					</td>
					<td colspan="3">
						<select name="roleSelect" id="roleSelect">
							
								<option value='2' selected="selected">
									&#31995;&#32479;&#31649;&#29702;&#21592;
								</option>
							
								<option value='3' selected="selected">
									&#39033;&#30446;&#32452;&#38271;
								</option>
							
								<option value='27' selected="selected">
									&#23567;&#32452;&#38271;
								</option>
							
						</select>
 
					</td>
 
				</tr>
 
 
				<tr>
					<td colspan="4">
						<table width="100%">
							<tr>
								<td colspan="2">
									角色所能使用的权限列表
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="1" />
								</td>
								<td>
									系统管理
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="2" />
								</td>
								<td>
									日志管理
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="3" />
								</td>
								<td>
									个人日志
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="4" />
								</td>
								<td>
									系统日志
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="5" />
								</td>
								<td>
									删除个人日志
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="6" />
								</td>
								<td>
									删除系统日志
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="7" />
								</td>
								<td>
									角色管理
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="8" />
								</td>
								<td>
									新增角色
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="9" />
								</td>
								<td>
									修改角色
								</td>
							</tr>
							
							<tr>
								<td>
									<input type="checkbox" name="privilegeList"
										value="10" />
								</td>
								<td>
									删除角色
								</td>
							</tr>
							
						</table>
					</td>
 
				</tr>
 
				<!-- 测试树控件begion -->
 
				<tr>
					<td colspan="4">
						<table width="100%">
							<tr>
								<td colspan="2">
									角色所能使用的权限列表
								</td>
							</tr>
 
							<tr>
								<td colspan="2">
									<div class="container">
										<div id="ajaxTree"></div>
                                        <div class="section">
                                        <script type="text/javascript">
                                        var tree=new _$.Tree();
                                        tree.root("功能权限列表",-1);
                                        tree.loadTree("tree.jsp?id=");//加载xhr，返回格式为json，符合[{},{}];
                                        tree.appendTo(_$("#ajaxTree").node);
                                        tree.isMultiple();//是多选树，fn为回调函数，可选
                                        
                                        </script>
                                        </div>

									</div>
								</td>
							</tr>
 
						</table>
					</td>
 
				</tr>
 
				<!-- 测试树控件end -->
 
				<tr>
					<td colspan="4" align="right">
						<input type="button" value="保存" onclick="doAddRole()" />
						&nbsp;&nbsp;
						<input type="button" value="取消" />
					</td>
 
				</tr>
			</table>
			<input type="hidden" name="prilisthidd" id="prilisthidd" />
		</form>
 
	</body>
 
	<script type="text/javascript"> 
	function doAddRole() {
		// 将选择的权限整理拼接
		var priStr = "";
		var priList = document.getElementsByName("privilegeList");
		for ( var i = 0; i < priList.length; i++) {
			if (priList[i].checked == true) {
				if (priStr != "") {
					priStr += ","; // 如果当前priStr中已经保存了元素了，那么就添加一个,进行分割
				}
				priStr += priList[i].value;
 
			}
		}
 
		// 把权限列表保存到一个隐藏的文本中
 
		var prilisthidd = document.getElementById("prilisthidd");
		prilisthidd.value = priStr;
 
		// 表单提交
		var form = document.getElementById("roleForm");
		form.submit();
 
	}
</script>
 
 
</html>

